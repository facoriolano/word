<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeWord 98</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              cw: {
                bg: '#1e1e2e',      // Deep Navy Background
                panel: '#282a36',   // Slightly lighter for toolbars
                paper: '#252538',   // Editor background
                pink: '#ff79c6',    // Accent 1 (Errors/Keywords)
                cyan: '#8be9fd',    // Accent 2 (Variables/Funcs)
                green: '#50fa7b',   // Accent 3 (Success)
                yellow: '#f1fa8c',  // Accent 4 (Strings/Const)
                orange: '#ffb86c',  // Accent 5
                purple: '#bd93f9',  // Accent 6
                text: '#f8f8f2',    // Main text
                comment: '#6272a4', // Dimmed text
                selection: '#44475a',
              }
            },
            fontFamily: {
              mono: ['"Fira Code"', 'monospace'],
              sans: ['"Inter"', 'sans-serif'],
              serif: ['"Merriweather"', 'serif'],
            }
          }
        }
      }
    </script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@400;500;600&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <style>
      /* Custom scrollbar to match theme */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #1e1e2e;
      }
      ::-webkit-scrollbar-thumb {
        background: #6272a4;
        border-radius: 5px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #ff79c6;
      }
      /* Editor specific overrides */
      [contenteditable]:empty:before {
        content: attr(placeholder);
        color: #6272a4;
        font-style: italic;
      }
      /* Selection color */
      ::selection {
        background: #44475a; 
        color: #f8f8f2;
      }
    </style>

    <!-- Import Map for CDNs -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.378.0",
    "@google/genai": "https://esm.sh/@google/genai@0.1.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>

    <!-- Babel Standalone for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-black text-cw-text h-screen overflow-hidden">
    <div id="root" class="h-full w-full flex items-center justify-center"></div>

    <!-- MAIN APPLICATION SCRIPT -->
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        Minus, Square, X, FileText, Settings, CircleHelp as HelpCircle, 
        Type, Save, Printer, Bold, Italic, Underline, AlignLeft, 
        AlignCenter, AlignRight, List, ListOrdered, Undo, Redo, 
        Sparkles, ChevronDown, Palette, Highlighter 
      } from 'lucide-react';
      import { GoogleGenAI } from "@google/genai";

      /**
       * ==========================================
       * CONFIGURATION FOR GITHUB / STATIC DEPLOY
       * ==========================================
       * Since this is a static HTML file, we shim process.env.
       * 
       * TODO: Replace 'YOUR_API_KEY_HERE' with your actual Gemini API Key
       * Get one here: https://aistudio.google.com/
       */
      window.process = {
        env: {
          API_KEY: 'YOUR_API_KEY_HERE' 
        }
      };

      // --- CONSTANTS ---
      const INITIAL_CONTENT = `
        <h1>Welcome to CodeWord 98</h1>
        <p>This is a <b>retro-styled</b> word processor inspired by the aesthetics of modern code editors.</p>
        <p>Type anywhere to start editing. Use the toolbar above to format your text.</p>
        <p><br></p>
        <p><i>Features include:</i></p>
        <ul>
          <li>Rich text editing</li>
          <li>Syntax-highlighting color palette</li>
          <li><b>AI Assistance</b> powered by Gemini</li>
        </ul>
      `;

      // --- TYPES ---
      const AiMode = {
        FixGrammar: 'FIX_GRAMMAR',
        Summarize: 'SUMMARIZE',
        Expand: 'EXPAND',
        ToneProfessional: 'TONE_PROFESSIONAL'
      };

      // --- SERVICE: GEMINI AI ---
      let genAIInstance = null;
      const getGenAI = () => {
        if (!genAIInstance) {
          const apiKey = window.process?.env?.API_KEY;
          if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
            console.warn("API Key is missing or default. Please edit the index.html file.");
            return null;
          }
          genAIInstance = new GoogleGenAI({ apiKey });
        }
        return genAIInstance;
      };

      const generateAiContent = async (text, mode) => {
        const ai = getGenAI();
        if (!ai) return "Error: API Key missing. Edit index.html to add your key.";

        const modelId = 'gemini-2.5-flash';
        let prompt = "";
        
        switch (mode) {
          case AiMode.FixGrammar:
            prompt = `Correct the grammar and spelling of the following text, maintaining the original meaning. Return only the corrected text:\n\n${text}`;
            break;
          case AiMode.Summarize:
            prompt = `Summarize the following text in a concise paragraph:\n\n${text}`;
            break;
          case AiMode.Expand:
            prompt = `Expand on the following text, adding more detail and depth while maintaining the style:\n\n${text}`;
            break;
          case AiMode.ToneProfessional:
            prompt = `Rewrite the following text to sound more professional and corporate:\n\n${text}`;
            break;
          default:
            prompt = text;
        }

        try {
          const response = await ai.models.generateContent({
            model: modelId,
            contents: prompt,
          });
          return response.text || "No response generated.";
        } catch (error) {
          console.error("Gemini API Error:", error);
          return "Error generating content. Check console/API Key.";
        }
      };

      // --- COMPONENT: TOOLBAR ---
      const Toolbar = ({ onFormat, onAiAction, isAiLoading }) => {
        const [showAiMenu, setShowAiMenu] = useState(false);

        const ToolBtn = ({ icon: Icon, onClick, active = false, label }) => (
          <button
            onClick={onClick}
            title={label}
            className={`
              flex items-center justify-center p-1 min-w-[28px] h-[26px] mx-[1px]
              border-t border-l border-b-black border-r-black
              ${active 
                ? 'bg-cw-selection border-t-black border-l-black border-b-cw-comment border-r-cw-comment' 
                : 'bg-cw-panel border-cw-comment hover:bg-cw-selection/50 active:border-t-black active:border-l-black active:border-b-cw-comment active:border-r-cw-comment'
              }
            `}
          >
            <Icon size={14} className={active ? 'text-cw-pink' : 'text-cw-text'} />
          </button>
        );

        const Divider = () => (
          <div className="w-[2px] h-[20px] bg-cw-comment/20 mx-1 border-l border-cw-selection/30 border-r border-black/30" />
        );

        return (
          <div className="flex items-center px-1 py-1 border-b border-cw-comment bg-cw-panel select-none relative z-20">
            {/* Handle - Drag Strip */}
            <div className="w-1 h-5 border-l border-cw-comment border-r border-black mr-2"></div>

            <div className="flex items-center space-x-0">
              <ToolBtn icon={Undo} onClick={() => onFormat('undo')} label="Undo" />
              <ToolBtn icon={Redo} onClick={() => onFormat('redo')} label="Redo" />
              <Divider />
              <ToolBtn icon={Bold} onClick={() => onFormat('bold')} label="Bold" />
              <ToolBtn icon={Italic} onClick={() => onFormat('italic')} label="Italic" />
              <ToolBtn icon={Underline} onClick={() => onFormat('underline')} label="Underline" />
              <Divider />
              <ToolBtn icon={AlignLeft} onClick={() => onFormat('justifyLeft')} label="Align Left" />
              <ToolBtn icon={AlignCenter} onClick={() => onFormat('justifyCenter')} label="Align Center" />
              <ToolBtn icon={AlignRight} onClick={() => onFormat('justifyRight')} label="Align Right" />
              <Divider />
              <ToolBtn icon={List} onClick={() => onFormat('insertUnorderedList')} label="Bullet List" />
              <ToolBtn icon={ListOrdered} onClick={() => onFormat('insertOrderedList')} label="Numbered List" />
              
              <Divider />
              
              {/* AI Dropdown */}
              <div className="relative">
                <button
                  onClick={() => setShowAiMenu(!showAiMenu)}
                  className={`
                    flex items-center gap-2 px-2 h-[26px] mx-1 text-xs font-bold tracking-wide
                    border-t border-l border-b-black border-r-black
                    transition-colors
                    ${isAiLoading 
                      ? 'bg-cw-selection cursor-wait border-t-black border-l-black border-b-cw-comment border-r-cw-comment' 
                      : 'bg-cw-purple text-cw-bg border-cw-comment hover:brightness-110 active:border-t-black active:border-l-black active:border-b-cw-comment active:border-r-cw-comment'
                    }
                  `}
                >
                  <Sparkles size={12} />
                  {isAiLoading ? 'THINKING...' : 'AI ASSIST'}
                  <ChevronDown size={10} />
                </button>

                {showAiMenu && (
                  <div className="absolute top-full left-0 mt-1 w-48 bg-cw-panel border-2 border-t-cw-comment border-l-cw-comment border-b-black border-r-black shadow-xl z-50">
                    {[
                      { label: 'Fix Grammar', mode: AiMode.FixGrammar },
                      { label: 'Summarize', mode: AiMode.Summarize },
                      { label: 'Expand Text', mode: AiMode.Expand },
                      { label: 'Make Professional', mode: AiMode.ToneProfessional },
                    ].map((item) => (
                      <button
                        key={item.mode}
                        onClick={() => {
                          onAiAction(item.mode);
                          setShowAiMenu(false);
                        }}
                        className="w-full text-left px-4 py-2 text-xs text-cw-text hover:bg-cw-selection hover:text-cw-pink transition-colors"
                      >
                        {item.label}
                      </button>
                    ))}
                  </div>
                )}
              </div>
            </div>
            
            {showAiMenu && (
              <div 
                className="fixed inset-0 z-10" 
                onClick={() => setShowAiMenu(false)}
              />
            )}
          </div>
        );
      };

      // --- MAIN APP ---
      const App = () => {
        const editorRef = useRef(null);
        const [isAiLoading, setIsAiLoading] = useState(false);
        const [wordCount, setWordCount] = useState(0);
        const [charCount, setCharCount] = useState(0);
        const [currentTime, setCurrentTime] = useState(new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
        const [isMaximized, setIsMaximized] = useState(false);

        useEffect(() => {
          updateStats();
          const timer = setInterval(() => {
            setCurrentTime(new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
          }, 1000);
          return () => clearInterval(timer);
        }, []);

        const updateStats = () => {
          if (!editorRef.current) return;
          const text = editorRef.current.innerText || "";
          setWordCount(text.trim().length === 0 ? 0 : text.trim().split(/\s+/).length);
          setCharCount(text.length);
        };

        const handleFormat = (command, value) => {
          document.execCommand(command, false, value);
          editorRef.current?.focus();
          updateStats();
        };

        const handleAiAction = async (mode) => {
          const selection = window.getSelection();
          if (!selection || selection.rangeCount === 0 || selection.toString().trim().length === 0) {
            alert("Please select some text to process with AI.");
            return;
          }
          
          const text = selection.toString();
          setIsAiLoading(true);
          
          try {
            const result = await generateAiContent(text, mode);
            if (result) {
              document.execCommand('insertText', false, result);
            }
          } catch (e) {
            console.error("AI Error:", e);
            alert("Failed to generate AI content.");
          } finally {
            setIsAiLoading(false);
            updateStats();
          }
        };

        const toggleMaximize = () => setIsMaximized(!isMaximized);

        const WinButton = ({ children, onClick, className = "", red = false }) => (
          <button 
            onClick={onClick}
            className={`
              flex items-center justify-center w-5 h-5 
              border-t border-l border-b-black border-r-black 
              active:border-t-black active:border-l-black active:border-b-cw-comment active:border-r-cw-comment
              active:bg-cw-selection
              ${red ? 'bg-cw-pink text-cw-bg' : 'bg-cw-panel border-cw-comment text-cw-comment'}
              ${className}
            `}
          >
            {children}
          </button>
        );

        return (
          <div className={`h-full w-full flex items-center justify-center p-4 bg-cw-bg font-sans transition-all duration-300 ${isMaximized ? 'p-0' : ''}`}>
            
            {/* Main Window */}
            <div className={`
              flex flex-col bg-cw-panel shadow-[10px_10px_0_0_rgba(0,0,0,0.5)]
              border-2 border-t-cw-comment border-l-cw-comment border-b-black border-r-black
              ${isMaximized ? 'w-full h-full' : 'w-full max-w-5xl h-[85vh]'}
            `}>
              
              {/* Title Bar */}
              <div className="h-8 bg-gradient-to-r from-cw-purple to-cw-pink flex items-center justify-between px-1 select-none">
                <div className="flex items-center gap-2 px-1">
                  <FileText size={16} className="text-cw-bg" />
                  <span className="font-bold text-cw-bg text-sm tracking-wide">CodeWord 98 - Untitled.doc</span>
                </div>
                <div className="flex gap-1">
                  <WinButton><Minus size={10} /></WinButton>
                  <WinButton onClick={toggleMaximize}><Square size={10} /></WinButton>
                  <WinButton red onClick={() => window.location.reload()}><X size={12} /></WinButton>
                </div>
              </div>

              {/* Menu Bar */}
              <div className="flex px-1 py-1 space-x-4 text-sm text-cw-text border-b border-cw-comment select-none">
                {['File', 'Edit', 'View', 'Insert', 'Format', 'Tools', 'Table', 'Window', 'Help'].map(menu => (
                  <span key={menu} className="px-1 cursor-pointer hover:bg-cw-selection hover:text-white first-letter:underline">
                    {menu}
                  </span>
                ))}
              </div>

              {/* Toolbar */}
              <Toolbar 
                onFormat={handleFormat} 
                onAiAction={handleAiAction} 
                isAiLoading={isAiLoading} 
              />

              {/* Ruler */}
              <div className="h-6 bg-cw-panel border-b border-cw-comment flex items-end px-4 overflow-hidden relative">
                <div className="w-full h-1/2 bg-cw-paper border border-cw-comment flex justify-between px-2">
                  {[...Array(20)].map((_, i) => (
                    <div key={i} className="h-full w-px bg-cw-comment opacity-50 text-[8px] pt-1">{i % 5 === 0 ? i : ''}</div>
                  ))}
                </div>
              </div>

              {/* Editor Area */}
              <div className="flex-1 bg-cw-selection/30 overflow-auto p-8 flex justify-center relative cursor-text" onClick={() => editorRef.current?.focus()}>
                
                {/* The Page */}
                <div 
                  className="bg-cw-paper w-full max-w-[800px] min-h-[1000px] shadow-2xl relative"
                  style={{ fontFamily: '"Fira Code", monospace' }}
                >
                   {/* Content */}
                   <div 
                    ref={editorRef}
                    contentEditable
                    className="w-full h-full p-12 outline-none text-cw-text leading-relaxed whitespace-pre-wrap selection:bg-cw-pink selection:text-cw-bg"
                    dangerouslySetInnerHTML={{ __html: INITIAL_CONTENT }}
                    onInput={updateStats}
                    spellCheck={false}
                  />
                </div>
              </div>

              {/* Status Bar */}
              <div className="h-7 bg-cw-panel border-t border-cw-comment flex items-center justify-between px-3 text-xs text-cw-comment select-none">
                <div className="flex gap-6">
                  <span className="flex items-center gap-1">Page 1/1</span>
                  <span className="flex items-center gap-1 border-l border-cw-selection pl-4">Sec 1</span>
                  <span className="flex items-center gap-1 border-l border-cw-selection pl-4">{wordCount} words</span>
                  <span className="flex items-center gap-1 border-l border-cw-selection pl-4">{charCount} chars</span>
                </div>
                <div className="flex gap-6">
                  <span className="uppercase">OVR</span>
                  <span className="uppercase text-cw-text font-bold">INS</span>
                  <span>{currentTime}</span>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- MOUNT ---
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
